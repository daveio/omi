# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Omi is an open-source AI wearable platform that captures conversations, generates summaries, action items, and executes actions. It's a multi-component system spanning hardware firmware, mobile/desktop apps, backend APIs, and web applications.

## Common Commands

### Flutter App (`/app`)

```bash
# Initial setup (creates Firebase configs, env, runs pub get + pod install)
cd app && bash setup.sh ios     # or: android, macos

# Run app (after setup)
flutter run --flavor dev

# Build runner for code generation
dart run build_runner build

# Format Dart code
dart format --line-length 120 <file>
```

### Backend (`/backend`)

```bash
# Setup
cd backend
cp .env.template .env
python -m venv venv && source venv/bin/activate
pip install -r requirements.txt

# Run server
uvicorn main:app --reload --env-file .env

# Format Python code
black --line-length 120 --skip-string-normalization <file>
```

### Web Frontend (`/web/frontend`)

```bash
cd web/frontend
npm install
npm run dev --turbo      # Development server
npm run build            # Production build
npm run lint             # ESLint
npm run lint:format      # Prettier
```

### MCP Server (`/mcp`)

```bash
cd mcp
uv sync                  # Install dependencies
pytest                   # Run tests
```

### Firmware (`/omi`, `/omiGlass`)

```bash
# Format C/C++ code
clang-format -i <file>
```

## Architecture

```
/app              Flutter mobile/desktop app (iOS, Android, macOS, Linux, Windows)
                  - Provider for state management
                  - dev/prod flavors with separate Firebase configs
                  - BLE communication with device

/backend          Python FastAPI backend
  /routers        API endpoint handlers
  /models         Pydantic models and database schemas
  /database       Firestore database operations
  /utils          Utilities including STT (Deepgram, Speechmatics, Soniox, Assembly)
  /modal          Serverless compute functions (Modal platform)

/omi              nRF device firmware (Zephyr RTOS, C/C++)
  /firmware       Main firmware source

/omiGlass         ESP32-S3 smart glasses firmware (Arduino/C++)

/web
  /frontend       Next.js 14 app marketplace and user dashboard
  /personas-*     AI personas web applications

/mcp              Model Context Protocol server for Omi API access

/sdks             Language bindings (Python, Swift, React Native, Expo)

/plugins          Third-party plugin framework and examples
```

## Key Infrastructure

- **Database**: Firebase Firestore + Redis (Upstash) for caching
- **Vector DB**: Pinecone for embeddings/semantic search
- **STT Services**: Deepgram, Speechmatics, Soniox, Assembly AI
- **LLM**: OpenAI-compatible APIs via LangChain
- **Serverless**: Modal for production backend compute
- **Auth**: Firebase Auth with Google/Apple sign-in
- **CI/CD**: GitHub Actions + Codemagic (app builds to TestFlight)

## Code Style

Pre-commit hook (`scripts/pre-commit`) auto-formats staged files:

- **Dart**: 120 char line length
- **Python**: black with 120 char line, skip string normalization
- **C/C++**: clang-format

To install the pre-commit hook:

```bash
cp scripts/pre-commit .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

## Environment Files

Copy templates before running:

- `/app/.dev.env` - Generated by setup.sh
- `/backend/.env` - Copy from `.env.template`
- `/web/frontend/.env.local` - Copy from `.env.template`
- `/mcp/.env` - Copy from `.env.template`

## BLE Protocol

The app communicates with devices via BLE. Key characteristics and services are defined in:

- `/app/lib/services/devices/` - Device connection handling
- `/omi/firmware/src/` - Device-side BLE implementation

## Plugin System

Plugins extend Omi functionality via webhooks. Plugin development:

- Backend endpoints: `/backend/routers/apps.py`, `/backend/routers/plugins.py`
- Plugin specs: `/plugins/` directory for examples
- Docs: https://docs.omi.me/doc/developer/apps/Introduction
